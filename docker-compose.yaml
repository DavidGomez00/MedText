# This file orchestrates the development environment. It defines
# two resources: Neo4j and Python.

version: '3.8'

services:
  neo4j:
    image: neo4j:5-community
    container_name: neo4j-graphrag
    restart: always
    ports:
      - "7474:7474" # HTTP/Browser interface
      - "7687:7687" # Bolt port (for client communication)
    volumes:
      - ./data/neo4j:/.data # Graph data persistence
    environment:
      # Use NEO4J_AUTH for authentication, as it's a common and robust way for Docker images.
      # The format is USER/PASSWORD.
      # We'll use the environment variables defined in .env for flexibility, with defaults.
      - NEO4J_AUTH=${NEO4J_USERNAME:-neo4j}/${NEO4J_PASSWORD:-password}
      - NEO4J_PLUGINS=apoc,graph-data-science

  python:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: medtext-python-dev
    depends_on:
      - neo4j
    network_mode: "host" # Use host networking for easier access to host services
    ports:
      - "8000:8000" # Example port for a web server, adjust if needed
    volumes:
      - .:/app # Mount the current directory to /app in the container
    environment:
      # Neo4j connection details
      # Use the service name 'neo4j' to connect to the Neo4j container
      - NEO4J_URI=neo4j://neo4j:7687
      - NEO4J_USERNAME=${NEO4J_USERNAME}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      # Ollama API URL. 'host.docker.internal' allows access to the host machine from the container.
      # Adjust if Ollama is running in another container or on a different host.
      - OLLAMA_API_URL=${OLLAMA_API_URL}
      - OHARA_API_URL=${OHARA_OLLAMA_API_URL}
    # Add this command to keep the container running for VS Code to attach
    command: tail -f /dev/null
